
# Репликация

## Short answer

**Репликация** в контексте баз данных, включая PostgreSQL, — это процесс копирования данных с одного сервера базы данных (основного или мастера) на другой сервер (реплику или слейв) для обеспечения отказоустойчивости, балансировки нагрузки или распределения чтения-запросов.

### Виды репликации:

1. **Синхронная репликация (Synchronous Replication)**:
   - В этом режиме основная база данных отправляет данные на реплику, и транзакция считается завершённой только после того, как данные подтверждены репликой. Это гарантирует, что все изменения на основном сервере сразу же появляются на реплике.
   - Преимущество: высокая гарантия консистентности данных.
   - Недостаток: замедление транзакций из-за необходимости ожидания подтверждения от реплики.

2. **Асинхронная репликация (Asynchronous Replication)**:
   - Основной сервер завершает транзакцию без ожидания подтверждения от реплики. Данные отправляются на реплику с небольшой задержкой.
   - Преимущество: высокая производительность основного сервера, поскольку транзакции выполняются быстрее.
   - Недостаток: возможна небольшая потеря данных при сбое основного сервера, так как реплика может не успеть получить последние изменения.

3. **Логическая репликация (Logical Replication)**:
   - Передача только логических изменений (операций INSERT, UPDATE, DELETE) между основным сервером и репликами. Логическая репликация позволяет реплицировать отдельные таблицы, а не всю базу данных.
   - Преимущество: возможность реплицировать только нужные части данных и более гибкая настройка.
   - Недостаток: не подходит для всех случаев, так как требует дополнительных настроек.

4. **Физическая репликация (Physical Replication)**:
   - Полное копирование данных с основного сервера на реплику на уровне блоков данных. Это наиболее распространённый тип репликации в PostgreSQL.
   - Преимущество: поддерживает полную копию базы данных, идеально для отказоустойчивости и восстановления после сбоев.
   - Недостаток: реплика является полной копией и не может быть использована для обработки разных данных или задач.

### Зачем нужна репликация?

1. **Отказоустойчивость (High Availability)**: Если основной сервер выйдет из строя, реплика может стать новым основным сервером, что минимизирует простой системы и потерю данных.
   
2. **Балансировка нагрузки (Load Balancing)**: Реплики могут обрабатывать запросы на чтение (SELECT), что уменьшает нагрузку на основной сервер и повышает общую производительность системы.

3. **Резервное копирование (Backup)**: Реплика может быть использована для создания резервных копий без нагрузки на основной сервер.

4. **Масштабирование (Scaling)**: В больших системах репликация помогает распределять нагрузку между несколькими серверами, увеличивая масштабируемость системы.

### Репликация в PostgreSQL

В PostgreSQL поддерживается несколько способов настройки репликации:
1. **Стриминг-репликация (Streaming Replication)**: PostgreSQL отправляет данные из WAL (Write-Ahead Logging) журнала на реплику в реальном времени.
2. **Логическая репликация**: Позволяет реплицировать только изменения на уровне транзакций для выбранных таблиц.
3. **Слотовая репликация (Replication Slots)**: Гарантирует, что WAL записи сохраняются до тех пор, пока все реплики их не получат, предотвращая потерю данных.

### Преимущества репликации:

- **Повышение отказоустойчивости**: Репликация защищает данные и гарантирует их доступность в случае сбоя основного сервера.
- **Улучшение производительности**: Чтения могут быть распределены на реплики, уменьшая нагрузку на основной сервер.
- **Резервное копирование**: Позволяет делать резервные копии базы данных без прерывания работы основного сервера.

### Недостатки:

- **Задержка при асинхронной репликации**: Возможна небольшая задержка в передаче данных на реплику, что может привести к неактуальным данным на реплике.
- **Сложность настройки**: Для обеспечения правильной работы и согласованности данных могут потребоваться дополнительные усилия по настройке и мониторингу.
- **Затраты на ресурсы**: Для поддержания нескольких реплик нужны дополнительные ресурсы, как аппаратные, так и программные.


## Full answer

[Статья с хабра](../data/Репликации%20в%20PostgreSQL%20_%20Хабр.pdf)

